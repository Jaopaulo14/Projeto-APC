#include <stdio.h>
#include <string.h>

/* Struct que irá conter as informações do produto para realizar as operações*/

struct produto{
  char nome [100];
  double preco;
  int quantidade;
};

typedef struct produto produto;

int compra(produto carrinho[1001],int indice_carrinho, double saldo){

  produto item;
  int i,a,comparacao,qtd_prod_removidos;
  
 
  scanf("%s",item.nome);
  getchar();
  scanf("%lf",&item.preco);
  getchar();
  scanf("%d",&item.quantidade);
  getchar();
  /*Vai ler as informações do produto que queremos*/

  /* Vamos verificar primeiro se não está extrapolando o saldo.
  Nesse caso vamos comprar o máximo de produtos que der */

 

  if((saldo - (item.quantidade * item.preco)) < 0){

  
    /* Vamos verificar o máximo de produtos que podemos retirar até o saldo poder cobrir*/
    for(i = 0, qtd_prod_removidos = 1; i < item.quantidade; i++){
       if((saldo - item.preco * (item.quantidade - qtd_prod_removidos)) < 0){
         qtd_prod_removidos++;
       }
    }
  }else{
    qtd_prod_removidos = 0;
    /* caso não precise remover produtos*/
  }

  /* Agora que temos a quantidade máxima de produtos que foram removidos, vamos
  atualizar nas informações do produto*/

  item.quantidade = item.quantidade - qtd_prod_removidos;

  /* se quantidade de produtos adicionados der zero, não vamos adicionar nada */

  if(item.quantidade > 0){

  
    /* Esse for ira verificar se exite algum produto semelhante no carrinho,
    caso houver a varivavel 'a' será incrementada*/
    for(i = 0, a = 0; i < indice_carrinho; i++){
  
        comparacao = strcmp(item.nome,carrinho[i].nome);
  
        if(comparacao == 0){
          a++;
          break;
          /* Com isso já vamos ter o indice do prduto igual que ficar em 'i'*/
        }
        
    }
  
    /* Vamos agora verificar o valor de 'a' se ele for difente de zero 
    significa que há algum item semelhante vamos somente alterar sua quantidade */

    if(a != 0){
      
      carrinho[i].quantidade = carrinho[i].quantidade + item.quantidade;
      
    }else{
  
      strcpy(carrinho[indice_carrinho].nome,item.nome);
      carrinho[indice_carrinho].preco = item.preco;
      carrinho[indice_carrinho].quantidade = item.quantidade;
      /* Vai colocar o produto no carrinho junto com suas informações */
      
      indice_carrinho++;
      /* vai para o próximo indice que está vazio esperar por outra compra */
  
    }
  }
  
  return indice_carrinho;
}

  
void mostra(produto carrinho [1001],int indice_carrinho){

  int i, k, indice_ascendente[1001];
  produto aux;
  double total;

  /* Temos que imprimir em ordem alfábetica então vamos comparar a 
  primeira coluna do nome de cada item  e trocar eles de lugar no carrinho*/

  for(i = 0; i < indice_carrinho; i++){

    for(k = i+1; k < indice_carrinho; k++){

      if(carrinho[i].nome[0] > carrinho[k].nome[0]){

        strcpy(aux.nome,carrinho[i].nome);
        aux.preco = carrinho[i].preco;
        aux.quantidade = carrinho[i].quantidade;

        strcpy(carrinho[i].nome,carrinho[k].nome);
        carrinho[i].preco = carrinho[k].preco;
        carrinho[i].quantidade = carrinho[k].quantidade;

        strcpy(carrinho[k].nome,aux.nome);
        carrinho[k].preco = aux.preco;
        carrinho[k].quantidade = aux.quantidade;

      }
    }
  }
  
  /*com o carrinho ordenado em ordem alfabética só imprimir*/

  for(i = 0; i < indice_carrinho; i++){
    
    printf("%s ",carrinho[i].nome);
    printf("%d X ",carrinho[i].quantidade);
    printf("%.2lf = ",carrinho[i].preco);
    printf("%.2lf\n",carrinho[i].preco * carrinho[i].quantidade);
    
  }
  for(i = 0, total = 0; i < indice_carrinho; i++){

    total = total + carrinho[i].preco * carrinho[i].quantidade;
    
  }
  printf("TOTAL: %.2lf\n",total);
}
  

int main() {

  int Q,i,indice_carrinho, a;
  double dinheiro_disponivel;
  char operacao;
  
  produto carrinho [1001];
  /* Vai ser o carrinho em que vamos fazer as operacoes*/

  indice_carrinho = 0;
  /* Vai controlar em que indice do vetor carrinho estamos para adicionar produtos em outras palavras
  irá mostrar quantos itens tem no carrinho*/
  
  scanf("%d %lf",&Q,&dinheiro_disponivel);
  getchar();
  /* Lendo a quantidade de operações a ser feita e o saldo disponivel para compras */

  
  for(i = 0; i < Q; i++){
    
    scanf("%c",&operacao);
    getchar();
    /* Vai ler a operção que vai ser feita */

    /* depois de ler a operação vamos ver qual executar */

    if(operacao == 'C'){
      
      indice_carrinho = compra(carrinho,indice_carrinho,dinheiro_disponivel);
      
      dinheiro_disponivel = dinheiro_disponivel - carrinho[indice_carrinho -1].preco * carrinho[indice_carrinho-1].quantidade;

      printf("%.2lf\n", dinheiro_disponivel);
    }
    if(operacao == 'M'){

      mostra(carrinho,indice_carrinho);
      
    }
      
  }
  
  return 0;
}
